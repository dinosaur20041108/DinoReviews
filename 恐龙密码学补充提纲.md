# 密码学引论补充提纲

    来自🦖密码学补充提纲计划 
    latest update：2024/12/11
    作者: 🦖 chy xqh Samdy
    本题纲是针对《密码学引论（第四版）》的补充提纲，主要整理书上缺失或不完整而PPT讲解的重点内容。

#### 乘法逆元求法

```
整个求解的过程就是使用辗转相除法求两个数的公约数，逆推出ax+py=gcd(a,p)=1即可。
例：a = 3,p = 17
2 = 17 − 3 ∗ 5
1 = 3 − 2 ∗ 1

然后我们通过等式的代换就可以得到a与p的关系
1=3−(17−3∗5)∗1
1=3−17∗1+3∗5
1=3∗6−17∗1
得到结果为6。
```

## 第二讲  密码学的基本概念

### 密码体制的分类

**从加密钥与解密钥是否相等划分：**

⑴ 传统密码/对称密码/单密钥密码：
Ke ＝ Kd
典型密码：DES，AES，SM4，ZUC，RC4

⑵ 公开密钥密码/非对称密码/双密钥密码：
Ke ≠ Kd 
且由Ke 不能计算出 Kd 
于是可将Ke公开，这样也不会危害Kd的安全
典型密码：RSA，ELGAMAL，ECC

**从密钥的使用方式划分：**

⑴ 序列密码：
明文、密文、密钥以位（字符）为单位加解密
核心密码的主流 （回顾：核心、普通、商密、个人）
典型密码：RC4，祖冲之密码（ZUC）

⑵ 分组密码：
明文、密文、密钥以块（分组）为单位加解密
商用密码的主流
典型密码：DES，AES，SM4

**从密码算法是否变化划分：**
⑴固定算法密码
密码在工作过程中算法固定不变，密钥可变
迄今为止的绝大多数密码都是固定算法密码
典型密码：AES，DES，SM4，RC4，ZUC，RSA，ELGAMAL，ECC   
⑵演化密码
借鉴生物进化，将密码学与演化计算结合
密码算法不断演化变化，而且越变越好
实现密码设计与密码分析自动化的一种方法
密码系统智能化的一种成功实践

**从是否基于数学划分**
⑴基于数学的密码：前面所有的密码

⑵基于非数学的密码

①基于物理学的密码：量子密码（量子密钥分发QKD）
利用量子力学产生真随机数作密钥，利用量子通信的保密性传输密钥，利用模2加进行加密，而且按一次一密方式工作
在唯密文攻击下无条件安全的密码
安全基于量子的物理属性  
②基于生物学的密码：DNA密码
已有各种密码方案
安全性基于生物学中的困难问题
由于不基于计算，所以无论计算机的计算能力多么强大，与DNA密码都是无关的
尚不成熟：缺少理论，技术实现复杂

## 第三讲  数据加密标准（DES）

**1、可逆性证明**

① 定义 变换T是把64位数据的左右两半交换位置：

 T(L,R)＝(R,L)
计算：T<sup> 2 </sup>(L,R)＝(L,R)＝I ,其中 I为恒等变换。
因为T<sup> 2 </sup> = I,所以有T =T<sup> –1 </sup>

  所以 T 变换是对合运算。        

②记 DES第 i 轮中的主要运算为,即

F<sub>i</sub>(L<sub>i</sub> –1,R<sub>i</sub> <sup> –1 </sup>)＝(L<sub>i</sub> <sup> –1 </sup>⊕f(R<sub>i</sub> <sup> –1 </sup>, K<sub>i</sub>),R <sub>i</sub> <sup> –1 </sup>)

F<sub>i</sub> <sup> 2</sup>＝F<sub>i</sub>(L<sub>i</sub> <sup> –1 </sup>⊕f(R<sub>i</sub> <sup> –1 </sup>, K<sub>i</sub>),R <sub>i</sub> <sup> –1 </sup>)
＝(L<sub>i</sub> <sup> –1 </sup>⊕f(R<sub>i</sub> <sup> –1 </sup>, K<sub>i</sub>)⊕f(R<sub>i</sub> <sup> –1 </sup>, K<sub>i</sub>),R <sub>i</sub> <sup> –1 </sup>)
＝(L<sub>i</sub> <sup> –1 </sup>,R<sub>i</sub> <sup> –1 </sup>)
＝I  
所以，F<sub>i</sub> ＝F<sub>i</sub> <sup> –1 </sup>

所以 Fi  变换也是对合运算。

③ 结合①、②，便构成DES的轮运算

H<sub>i</sub> ＝ F<sub>i</sub>T 
因为(F<sub>i</sub>T)(TF<sub>i</sub>)=(F<sub>i</sub>(TT)F<sub>i</sub>)= F<sub>i</sub>F<sub>i</sub> =I  
所以
(F<sub>i</sub>T)<sup> -1 </sup>＝(TF<sub>i</sub>)  
(F<sub>i</sub>T)＝(TF<sub>i</sub>)<sup> -1 </sup>

④加解密表示

⑴   DES(M) ＝(M)IP (F1T) (F2T) … (F15 T) (F16) IP <sup> -1 </sup> ＝C
⑵   DES<sup> -1 </sup>(C)＝(C)IP (F16 T) (F15 T) …(F2 T) (F1) IP <sup> -1 </sup> ＝M
把 ⑴ 式代入 ⑵ 式可证：
         DES<sup> -1 </sup> (DES (M))＝M    
所以，DES是可逆的。

**2、对合性证明**

DES  ＝ IP (F1T) (F2T) … (F15 T) (F16) IP <sup> -1 </sup>   
DES<sup> -1 </sup>＝ IP (F16 T) (F15 T) …(F2 T) (F1) IP <sup> -1 </sup>  
DES和DES<sup> -1 </sup> 除了子密钥的使用顺序相反之外是相同的。

不考虑子密钥的使用顺序：  
DES  ＝IP (F) (TF) (TF)…(TF) (TF) (TF) IP<sup> -1 </sup>       
DES<sup> -1 </sup>＝IP (F) (TF) (TF)…(TF) (TF) (TF) IP<sup> -1 </sup>  
显然：DES = DES<sup> -1 </sup>
所以DES的运算是对合运算。

**DES的安全性**

①攻击

穷举攻击。这是目前最有效的方法。  
差分攻击。  
线性攻击。

②安全弱点

密钥太短。这是最主要的弱点。  
存在弱密钥（如输入为全0和全1，输出也是全0全1。因为操作全为移位、置换并不改变内容）。  
存在互补对称性（DES互补性：DES加密中若将明文消息X和加密密钥K都逐比特位取反，则加密的密文也是原密文逐比特位取反）。这使得攻击复杂度下降一半。  
设C=DES（M，K），则有C=DES（M，K）。  

## 第四讲  高级数据加密标准（AES）

③**不是对合运算**:  
加解密使用不同的算法。  
       (AES)-1≠AES  
解密算法的结构与加密算法的结构相同  
解密中的变换为加密算法变换的逆变换，且密钥扩展策略稍有不同。

⑤整体结构:SP结构，基本轮函数迭代，迭代轮数可变（≥10）

**AES的GF(2<sup> 8 </sup>)表示**  
加法：两个元素多项式的系数按位模2加  
(x6+x4+x2+x+1)⊕(x7+x+1)= x7+x6+x4+x2  
乘法：两个元素多项式相乘，模 m (x),当除法不断减x<sup>n</sup>倍求余数就行  
(x6+x4+x2+x+1)×(x7+x+1)=x7+x6+1 mod m (x)  
转换成二进制运算也可以

**S盒变换 ByteSub(State)**  
①S盒变换是AES的唯一的非线性变换，是AES安全的关键，起密码学的混淆作用  
②AES使用16个相同的S盒，DES使用8个不相同的S盒。  
③AES的S盒有8位输入8位输出，是一种非线性置换。DES的S盒有6位输入4位输出，是一种非线性压缩。  



## 第五讲  中国商用密码SM4与分组密码的应用技术

*重点内容与书上重复*


## 第6讲 序列密码基础
*重点内容与书上重复*

## 第7讲 祖冲之密码

*重点内容与书上重复*

## 第8讲 Hash函数的概念


### Hash函数的定义

*一般，h的长度小于M的长度，因此HASH函数是一种压缩变换。

②**实用性**：对于给定的数据M，计算h=Hash (M)是高效的。  
③**安全性**（这部分与课本一样，课本有详细解读）

### Hash函数的类型

ppt上对基于序列密码的Hash函数多了一条：
目前有许多强分组密码，都可设计Hash函数。基于序列密码设计Hash函数较少，**ZUC的MAC是一个例子**


## 第十讲  公钥密码基础
### 一、公钥密码的基本思想
#### 传统密码的优缺点：

**优点**
* 理论和实践都很成熟
* 安全容易把握
* 加解密速度快

**缺点**
* 收发双方持有相同密钥，Ke=Kd，密钥分配困难，网络环境更突出。
* 不能方便地实现数字签名，商业等应用不方便。
  


#### 公钥密码的理论模型
（一）**单向函数**

**设函数 y=f(x)，如果满足以下两个条件，则称为单向函数：**
* 如果对于给定的 x，要计算出 y=f(x)很容易；
* 而对于给定的 y，要计算出 x=f -1(y)很难
  
（二）**利用单向函数构造密码**
* 用正变换作加密，加密效率高；
* 用逆变换作解密，安全，敌手不可破译；
* 但是合法收信者也无法解密。
  
（三）**单向陷门函数**

**设函数 y=f(x)，且 f 具有陷门，如果满足以下两个条件，则称为单向陷门函数：**
* 如果对于给定的 x，要计算出 y=f(x) 很容易；
* 而对于给定的 y，如果不掌握陷门要计算出x=f -1(y)很难，而如果掌握陷门要计算出 x=f -1(y)就很容易。
  
（四）**利用单向陷门函数构造密码**
* 用正变换作加密，加密效率高；
* 用逆变换作解密，安全； 
* 把陷门信息作为密钥，且只分配给合法用户。确保合法用户能够方便地解密，而非法用户不能破译。

（五）**单向函数的研究现状**

**理论上**：尚不能证明单向函数一定存在；
**实际上**：密码学认为只要函数单向性足够应用就行了； 


## 第十一讲  中国商用公钥密码SM2加密算法
### 一、椭圆曲线
#### 1、素域上的椭圆曲线

椭圆曲线特性：曲线的所有点都没有两个或者两个以上的不同的切线。

#### 2、 GF(2<sup>m</sup>)上的椭圆曲线
除了GF(p)上的椭圆曲线，还有定义在GF(2<sup>m</sup>)上的椭圆曲线。
基于这两种椭圆曲线都可以设计出安全的椭圆曲线密码。  
*注意：GF(2<sup>m</sup>)上的椭圆曲线与GF(p)上的椭圆曲线的加法定义不同。（见书）*

### 三、椭圆曲线公钥密码
#### 1、椭圆曲线密码的一般情况

**我国商用密码采用了椭圆曲线密码，并颁布了椭圆曲线密码标准算法SM2。**  
椭圆曲线密码已成为除RSA密码之外呼声最高的公钥密码之一。
它密钥短，软件实现规模小、硬件实现节省电路。
**由于椭圆曲线离散对数问题尚没有发现亚指数算法，所以普遍认为，椭圆曲线密码比RSA和ElGamal密码更安全。**  
ElGamal密码建立在有限域GF(p)的乘法群的离散对数问题的困难性之上。而椭圆曲线密码建立在椭圆曲线群的离散对数问题的困难性之上。**两者的主要区别是其离散对数问题所依赖的群不同。** 因此两者有许多相似之处。
基于GF(p)和GF(2<sup>m</sup>)上的椭圆曲线，都可以构成安全的椭圆曲线密码。

#### 3、GF(p)上的椭圆曲线密码和ElGamal密码的对比
##### (1)密钥生成
**椭圆：**
用户选择一个随机数d作为私钥，d∈{1,2,···,n-1}。
用户计算 Q=dG ，以Q点为自己的公开钥。
**ElGamal：**
用户随机地选择一个整数d作为自己保密的解密钥，2≤d ≤p-2 。
用户计算		y =α<sup>d</sup> mod p，以y为自己的公开钥。
##### (2)加密
**椭圆：**
设明文数据为M，0≤ M ≤ n-1 。  
**加密过程**：
* 选择一个随机数k，k∈{1,2,···,n-1}。
* 计算点X1(x1 ,  y1) = kG 。
* 计算点X2(x2  ，y2) =kQ（公钥），
* 如果分量x2=0，则转①。
* 计算密文C=Mx2 mod n 。
* 以(X1，C)为最终密文。

**ElGamal：**
设明文消息M（0≤M≤p-1）  
**加密过程**：
* 随机地选取一个整数k，2≤k≤p-2。
* 计算:
   C1＝α<sup>k </sup> mod  p； 
		  U ＝y<sup>k</sup> mod  p；
         	  C2＝UM  mod  p；
* 取C＝(C1 ，C2)为最终密文
  
##### (3)解密：

**椭圆**
* 用私钥d求出点X2 ：
    	dX1 = d(kG)= k(dG) = kQ = X2(x2 ，y2)
* 对C 解密：利用x2计算得到明文 M =C x<sub>2</sub> <sup>–1</sup>  mod n 

**ElGamal**
* 计算V＝C<sub>1</sub> <sup>d</sup>        mod  p= (α<sup>k</sup>)<sup>d</sup> mod p 	      = (α<sup>d</sup>) <sup>k</sup>   mod  p= (y) <sup>k</sup>      mod  p =U
* 计算M＝C<sub>2</sub>  V <sup>-1</sup> mod  p

#### 4、GF(p)上椭圆曲线密码的实现

**难点**：
* 安全椭圆曲线的产生；
* 倍点运算比较麻烦。

### 四、中国商用椭圆曲线公钥密码SM2
使用256位素域GF(p)上的椭圆曲线：
y<sup>2</sup> = x<sup>3</sup> + ax + b

#### 5、解密正确性
* 证明：
  d<sub>B</sub>C<sub>1</sub>=d<sub>B</sub>(kG) =k(d<sub>B</sub>G) =kP<sub>B</sub> = (x<sub>2</sub>，y<sub>2</sub>)；
	如果(x<sub>2</sub>，y<sub>2</sub>)是正确的，则t =KDF(x<sub>2</sub> ‖ y<sub>2</sub>, klen)也将是正确的。
	又因为加密时C<sub>2</sub> = M ⊕ t，所以解密时	M′= C<sub>2</sub>⊕t 。
* 验证：
  根据解密得到的x2、y2和M′重新计算C3，并于接收到的C3比较，若两者相等则说明密文和解密正确，否则说明密文或解密不正确。

#### 6、比较
**传统椭圆曲线密码**
* 计算点X2（x2 ，y2）=kQ。
* 计算密文 C = Mx2  mod n 。
* 最终密文是< X1，C > 
  
**SM2**
* 计算点kPB=(x2，y2)；
* 计算t =KDF(x2 ‖ y2, klen) ；
* 计算C2 = M ⊕ t；
* 最终密文是< C1 ， C2 ， C3  > 
  
**传统椭圆曲线密码**
* 利用分量x2作密钥进行加密：C = m x2  mod n ，加密运算是乘法比较复杂。
* 分量y2没有利用。
* （X1，C）为密文。

**SM2**
* 利用分量x2和y2经过密钥派生函数产生中间密钥t，再用t进行加密：C2 = M ⊕ t，加密运算是模2加，因此效率更高，密钥派生函数提高了安全性，却增加了时间消耗。 
* C = C1 ‖ C2 ‖ C3为密文，密文数据扩张较前者严重。
* SM2 采取了许多检错措施，从而提高了密码系统的数据完整性和系统可靠性，进而提高了密码系统的安全性。

*对于SM2所使用的椭圆曲线，h=1。因此，步骤③对于保密来说是非本质的。但是，如果h或P<sub>B</sub>发生了错误或PB选得不好，致使S=hP<sub>B</sub>=O，则它可以把错误检查出来。
在解密算法中加入了更多的检错功能，这是因为解密的密文是经过信道传输过来的，由于信道干扰的影响和对手的篡改，在密文中含有错误或被篡改的可能性是存在的。采取措施把错误和篡改检测出来，对提高密码系统的数据完整性、系统可靠性和安全性是有益的。*


## 第十二讲  数字签名基础

### 二、数字签名模型
一个数字签名体制包括两个方面的处理：  
**施加签名：** 为数据产生签名  
**验证签名：** 验证签名的真伪

### 三、利用RSA密码实现数字签名
#### 1、利用公钥密码实现数字签名的一般方法
**凡是能够构成安全SIG和VER的公钥密码都可实现数字签名**
 RSA密码、ElGamal密码、椭圆曲线密码、许多其他密码

**为了实施数字签名，应成立管理机构；**
 制定规章制度，统一技术标准，用户登记注册，纠纷的仲裁，其它。

 #### 2、利用RSA密码实现数字签名：
对于RSA密码， D(E(M))=(M<sup>e</sup>)<sup>d</sup> =M<sup>ed</sup> =(M<sup>d</sup>)<sup>e</sup> =E(D(M)) mod n，所以RSA可同时确保数据的秘密性和真实性。在这里，SIG=D，VER=E
因此利用RSA密码可以同时实现数据加密和数字签名。

##### （1）签名算法
设M为明文，K<sub>eA</sub> =<e,n>是A的公开加密钥，K<sub>dA</sub> =<d,p,q,φ(n)>是A的保密的解密钥，则A对M的签名过程是，S<sub>A</sub> = D(M，K<sub>dA</sub>) =（M <sup>d</sup> ）mod  n，S<sub>A</sub> 便是A对M的签名。
验证签名的过程是， E（S<sub>A</sub> ，K<sub>eA</sub>）=（M <sup>d</sup> ）<sup>e</sup>  mod  n = M 
如果收信者验证得到正确的数据M，则签名为真。 

*上述验证中，如果收信者验证得到正确的数据M，则判定签名为真。有时收信者事前不知道M，如何判定？*

* 方法一：合理设计明文的数据格式
  [![Screenshot_2024_1211_100044(1).png](https://www.helloimg.com/i/2024/12/11/6758f2768c9dd.png)](https://www.helloimg.com/i/2024/12/11/6758f2768c9dd.png)
  只要用A的公钥验证签名并恢复出正确的附加信息H = < A，B，I，T >，便可断定明文M是否正确。
	记接收到的附加信息为H，恢复出的为H'，仅当H=H'时判定签名为真。
设附加信息 H=<A，B，I，T> 的二进制长度为L ，则错判概率  p<sub>e</sub>≤ 2<sup>-L</sup> 。 

* 方法二：对Hash（M）签名
[![Screenshot_2024_1211_100416(1).png](https://www.helloimg.com/i/2024/12/11/6758f34ad8793.png)](https://www.helloimg.com/i/2024/12/11/6758f34ad8793.png)

**（2）对RSA数字签名的攻击**
①一般攻击:
因为e和n是用户A的公开密钥，所以任何人都可以获得并使用e和n。攻击者可随意选择一个数据Y，并用A的公钥计算  
X ＝（Y）<sup>e</sup> mod n  
因为 Y ＝（X）<sup>d</sup> mod n ，于是可以用Y 伪造A的签名。因为Y 是A对X 的一个有效签名。  
*注意：这样的 X 往往无正确语义！因此，这种攻击在实际上有效性不大！*

②利用已有的签名进行攻击:
攻击者选择随机数据 M3，且M3=M1M2 mod n 。  
攻击者设法让A对M1和M2签名：S1＝（M1）<sup>d</sup> mod n ， S2＝（M2）<sup>d</sup> mod n  
于是可以由S1和S2计算出A对M3的签名。因为S1S2=(M1)<sup>d</sup>(M2)<sup>d</sup> mod n =（M3）<sup>d</sup> mod n = S3
**对策：A不直接对数据M 签名，而是对HASH(M)签名。**
此时：S1＝(HASH(M1))<sup>d</sup> mod n ， S2＝(HASH(M2))<sup>d</sup> mod n  
而，(HASH(M1))<sup>d</sup> (HASH(M2))<sup>d</sup>≠(HASH(M1M2))<sup>d</sup> mod n   
所以：S3≠S1S2 ，于是不能由S1和S2计算出A对M3的签名。

③攻击签名获得明文:
攻击者截获C，C＝(M )<sup>e</sup> mod n 。  
攻击者选择小的随机数r，计算：x = r <sup>e</sup> mod n，y =xC mod n ， t = r <sup>-1</sup> mod n  
攻击者让A对y签名， S = y<sup>d</sup> mod n ，于是攻击者又可截获S  
攻击者计算tS=r <sup>-1</sup>y<sup>d</sup>=r <sup>-1</sup>x<sup>d</sup>C<sup>d</sup>=C<sup>d</sup> =M mod n  
**对策：A不直接对数据M签名，而是对HASH(M)签名**

**结论**
* 不直接对数据M签名，而是对HASH(M)签名。
* 使用时间戳
* 对于同时确保秘密性和真实性的通信，应当先签名后加密（致使无法对签名进行攻击）。
  


### 四、利用ElGamal密码实现数字签名
**利用ELGamal密码可以构建安全的SIG和VER，所以可以实现数字签名**  
如果知道了k重复使用签名的m1和m2，便可求出k，进而求出保密的解密钥。
**由此可知，不要随便给别人签名。不要直接对m签名，而是对HASH(m)签名。**  
签名时需要使用随机数k，所以需要有良好的随机数产生器。
**缺点**：由于取（r，s）作为m的签名，所以数字签名的长度是明文的两倍，数据扩张一倍。

## 第十三讲 中国商用公钥密码SM2签名算法
传统椭圆曲线签名直接使用m产生签名；  
而SM2使用M* =ZA‖M， e = Hash(M*)  
SM2使用了用户参数和系统参数，起到一定的认证作用，提高了安全性：  
IDA是A的标识。ENTLA是IDA的长度。基点是G = (xG, yG)   
A的私钥是dA，A的公钥是PA=dAG = (xA, yA)  
ZA=Hash (ENTLA‖IDA‖a‖b‖ xG‖yG‖xA‖yA)  
传统椭圆曲线签名算法计算：点R（x R ,y R）= kG，并记   r = x R ；  
SM2计算：点G1(x1, y1)=kG，且计算r = (e+x1) mod n；  
传统椭圆曲线签名算法计算：  
		s＝(m－dr)k-1 mod n ；  
SM2计算：s = ((1 + dA)−1 · (k − r · dA)) mod n。M 没有直接出现，而是通过r参与其中；私钥dA 作用了两次。  
SM2增加了合理性检查，确保签名正确，提高安全性。  
例如第⑤中检查r+k=n是否等于n。    
如果r+k=n，则k = -r mod n，会使s = ((1 + dA)−1 · (k − r · dA)) mod n = ((1 + dA)−1 · (-r)(1 + dA)) = -r mod n 。 s = -r mod n，显然是不合适的。

## 第十四讲  密码协议
*重点内容与书上重复*

## 针对考试的补充

如果给你们一个场景，要求安全地把重要信息通过邮件发给对方，应该怎么从密码学的角度设计这个系统?比如考虑到窃听，因此要加密，于是使用对称加密，但是密钥怎么传输呢，因此又使用公钥加密...
![Alt text](image-2.png)
### 案例分析：网上银行系统

密码应用需求

    用户的身份鉴别
    关键数据的机密性保护
    关键数据的完整性保护
    交易行为的不可否认性
    密钥管理

用户的身份鉴别（我是谁？我有什么？我知道什么？）

    智能密码钥匙：用于设备管理员、用户身份鉴别，以及对设备和应用的相关访问控制信息、日志信息、应用程序等进行完整性保护，主要依赖密码算法：数字签名、哈希函数、分组加密	
    动态令牌：用户身份鉴别介质，主要依赖密码算法：哈希函数、分组加密
    动态口令认证系统：验证动态口令的正确性，实现用户身份鉴别

关键数据的机密性和完整性保护

    业务数据：交易信息、财务信息等
    鉴别数据：用户信息、支付密码、登陆密码等
    安全浏览器：连接SSL VPN，保护客户端与Web服务器之间通信数据的机密性和完整性，并实现基于证书的鉴别、签名等密码服务，主要依赖密码算法：数字签名、哈希函数、对称加密	
    SSL VPN 网关：与安全浏览器建立安全通信通道，保护两者通信数据的机密性和完整性，主要依赖数字签名、哈希函数和对称加密；
    数据库服务器：安全存储，主要依赖哈希函数和对称加密

关键数据的完整性保护

    日志数据：系统日志、操作日志、登录日志
    日志服务器：安全存储，主要依赖哈希函数

密钥管理

    保密密钥管理，对称密钥、私钥，包括三层密钥管理体系。
    非对称密钥的管理，基于PKI技术实现公钥管理，数字证书体系。

![Alt text](image-1.png)

加密和签名的顺序问题  
对于公钥密码，任何人都可以进行公钥操作，即任何人都可以加密消息，任何人都可以验证签名（并且重新签名）

先加密后签名  
C截获A发给B的消息，然后验证签名，然后用自己的私钥签名发给B，B会认为是C发的而不是A发的

先签名后加密  
A发给B，B解密获得消息之后不做好事，篡改消息发给C，C以为A发消息骂他

### AES中AddRoundKey的作用

没有任何秘钥参与的变换都是容易被攻破的，这一点比DES好，因为DES的IP和IP-1都没有密钥参与。同时将轮密钥与state进行混合，避免明文直接参与运算，即把输入数据打乱，消除原始输入数据的原有数据模式如果没有第一个AddRoundKey，那么第一轮会直接对明文进行操作，对于已知明文攻击没有加密价值。  
考虑最基本的攻击：使用已知的明文/密文对进行暴力密钥搜索。使用第一个AddRoundKey时，第一个轮的输入将会受密钥影响而改变，攻击者必须为每个测试的密钥计算该排列，并且对于每个测试的密钥，其输出都非常不同。但是，如果没有第一个AddRoundKey，则第一轮置换的输出是一个常量，对手可以以可忽略的成本进行一次计算。本质上，浪费了一轮AES。  
出于同样的原因，最后一个AddRoundKey在这里。并且删除了最后一轮的MixColumns，因为如果存在它，则有可能交换最后一轮的MixColumns和最后一个AddRoundKey（在对最后一个子项进行线性转换之后），然后最后一轮的MixColumns将是公共排列对密文进行操作，因此没有密码价值。

### 论述分析某一类的应用问题

    1.用密码学的原理，给出安全性方案/框架;去覆盖/分析安全性问题  
    描述应用场景具体应用问题:人物地点事件交互  
    分析正确的操作流程下，有什么角色和角色的信息流转  

    2、存在哪些安全性隐患:  
    如何找安全性问题?找原理，用什么原理可以覆盖它;  
    构造攻击者模型;至少找2-3个漏洞(A/E)  
    攻击者模型答:要什么、有什么、形式化分析(?);  复杂度变化分析;流程图、算法…表述都可以(写清楚)  
    如何填补这些漏洞/隐患;哪些方法强化AE(两个方面);这个部分越详细越好  
    给一个系统(区块链?支付宝微信支付?);讲运作流程;潜在的威胁(攻击者模型);怎么让他安全/安全性设计(密码协议/认证);

### 认证

    什么是认证？认证和数字签名的区别是什么？

    设计题
    1）动态口令（网银）（有一个攻击者不知道的输入）
    时间输入，用户 ID（每个用户不同，可以不保密），银行设置的系统密钥（所有用户共享）（硬件保护，永远不能读出），做 HASH
    解决时间误差：把时间往前调，往后调，若相同则成功，服务器跟着偏移
    2）校园卡与刷卡器
    刷卡器中保有系统密码，由系统密钥和用户 ID 生成用户密钥（校园卡中有一个用户 ID），再进行身份认证。
    3）PING 码（U 盾中）：U 盾在认证人
    U 盾中装有一个很长的签名用的私钥，它的启用是由一个很短的口令保护（长了人记不住）
    存在问题：解决：限制输入次数
    4）Windows 密钥管理（域控制服务器：控制多台设备）
    A 想访问 B，但不信任，都信任 S，S 生成会话秘钥，只能使用 8 小时
    A 与 S 之前通信要加密，用事先确认的密钥，A 向 S 表示想访问 B，S 查 A 是否有权限，S 给一个密文给 A，是用 S 和 B 间的密钥加密。
    S 给 A 会话密钥，A 把密文给 B
    B 验证密文是否是 S，密文解密后是会话密钥、A 的 ID
    缺点：只适用于小规模，因为服务器要一直开介绍信
    不适合互联网环境（互联网环境中基于 PKI 实现）
    A、B 两者间的可信通信
    认证：仅身份认证+产生后续通信的会话密钥
    数字签名：仅完成身份与消息的绑定
    （漏洞：A 可以抵赖或自己没有发这个消息，因为 B 有可能伪造）
    ①A,B 共享密钥 k
    A (消息+k 消)hash 签名 B
    B 用 k 验签
    ②A 有公钥，B 有私钥
    A 私钥对消息签名+消息 B
    用公钥验签，万一 A 抵赖则提供给第三方

### 证书

    ①证书给谁
    ②目标方的公钥是什么
    ③第三方用私钥对①②的签名
    RSA 根证书在更新的过程中，需要所有证书拥有者更新公钥
    如何让证书拥有者相信公钥的发布方是 RSA？
    1990 年 发布 1990 年公钥和 2000 年公钥的哈希值（发布消息和公钥哈希的结果）
    2000 年 发布 2000 年公钥和 2010 年公钥的哈希值
    以上：用公钥密码提供身份认证，适用于：用户特别多
    PKI：公钥密码基础设施
    CA：证书颁发机构
    RA：注册认证机构
    CRL：证书吊销列表
    签名私钥绝对不能备份，坏了就重新申请再发布公钥
    失窃了“挂饰”，告知权威第三方通知所有人旧证书不可行

### 《密码法》

    01 什么是密码？ 
    根据密码法（第二条）的法律定义：密码是指采用特定变换的方法对信息等进行加密保护、安全认证的技术、产品和服务。
    其实，这个关于密码概念的定义，即是法律定义，也是业界公认的技术定义。这里有两个关键点，一个是密码的工作方法：特定的“变换”，一个是密码的作用：“加密保护”与“安全认证”。
    因此，我们生活中在登录界面输入“密码”，以及人脸识别、指纹识别、声纹识别等生物识别技术，都不是真正的密码，它们只是“登录口令”，是某种特征的输入和匹配。而真正的密码则工作在这个过程的背后。在你“刷脸”的时候，以及系统存储你的面部特征信息的时候，系统都会用密码对这些信息进行加密，以保护你的身份特征信息不被黑客窃取。
    02 密码分几级？ 
    密码法根据应用场景和加密强度的要求，把密码范围三级（第六条、第七条）：核心密码、普通密码和商用密码
    其中核心密码、普通密码都是用于保护国家秘密信息的密码。核心密码保护信息的最高密级为绝密级，普通密码保护信息的最高密级为机密级。而商用密码则是用于保护不属于国家秘密的信息的密码，用于保护公民、法人和其他组织的信息安全。特别的，普通密码其实一点都不普通。这个名字只不过是业界的一种通行叫法而已。而且，密码法还明确说明：核心密码、普通密码属于国家秘密。
    03 哪些行为属于与密码相关的违法犯罪行为？ 
    密码法主要规定了三种情形（第十二条）属于与密码相关的犯罪：
    一、窃取他人加密保护的信息。
    二、非法侵入他人的密码保障系统。
    三、利用密码从事危害国家安全、社会公共利益、他人合法权益等违法犯罪活动。
    例如，制作勒索病毒、加密传播木马病毒及各类不法信息，都属于第三种情形。
    04 做密码工作是否需要持证上岗？ 
    一般不用。但如果要做核心密码和普通密码，就需要“持证上岗”了。
    密码法（第十八条）规定：国家建立适应核心密码、普通密码工作需要的人员录用、选调、保密、考核、培训、待遇、奖惩、交流、退出等管理制度。
    05 生产和销售密码产品，是否必须经过检测认证？ 
    这个问题，简单的说就是：生产者自愿，但使用领域受限。
    根据密码法（第二十五条）要求：国家鼓励商用密码从业单位自愿接受商用密码检测认证，提升市场竞争力。但法律对此并不强求。
    同时密码法（第二十六条）也要求：涉及国家安全、国计民生、社会公共利益的商用密码产品，应当依法列入网络关键设备和网络安全专用产品目录，由具备资格的机构检测认证合格后，方可销售或者提供。
    06 企业、行业可以自定密码标准吗？ 
    可以。 
    根据密码法《第二十二条》规定，密码即有国家标准，也可以有行业标准，同时，在商用密码领域，国家还支持社会团体、企业制定高于国家标准、行业标准的团体标准、企业标准。
    07 外商必须使用中国密码吗？国产密码在外国能用吗？ 
    在除关键信息基础设施之外的一般商用领域，使用什么密码是企业的自由，外商和国内企业一视同仁。同时，国产密码也在走向国际化。例如，SM2、SM3、SM4、SM9、祖冲之序列密码算法等国产密码算法，已经成为国际标准，或者获得国际标准提案立项。
    密码法（第二十一条）要求有关部门应当遵循非歧视原则，依法平等对待包括外商投资企业在内的商用密码科研、生产、销售、服务、进出口等单位。国家鼓励在外商投资过程中基于自愿原则和商业规则开展商用密码技术合作。行政机关及其工作人员不得利用行政手段强制转让商用密码技术。
    同时，密码法（第二十三条）还指出：国家推动参与商用密码国际标准化活动，参与制定商用密码国际标准，推进商用密码中国标准与国外标准之间的转化运用。
    08 密码也能进出口吗？ 
    能，但有限制。 根据密码法（第二十八条）要求：对涉及国家安全、社会公共利益且具有加密保护功能的商用密码实施进口许可，对涉及国家安全、社会公共利益或者中国承担国际义务的商用密码实施出口管制。但是，大众消费类产品所采用的商用密码不实行进口许可和出口管制制度。


### 3.1 智能卡安全协议的业务需求分析


身份合法性鉴别。对于一个智能卡系统，如何辨别通信双方合法性是一个重
要的问题。我们在所有通信交易之前，必须对进行交易的双方进行一个身份
的鉴定，只有在保证通信双方身份合法的前提下才可以进行后续交易，否则
应立即拒绝交易。  
数据的保密性。即使通信双方已经确定了对方的合法性并开始进行交易，但
在通信过程中数据的保密性依然非常重要，否则一旦双方的通信内容被第三
方非法窃取甚至修改，将造成巨大的损失。所以在通信过程中我们需要保证
数据的保密性，防止第三方非法获取或修改通信信息，以确保交易过程的通
信安全。  
数据完整性。在通信过程中，由于外部环境的不确定性，导致接收方在接收
到数据时无法确认该数据就是发送来的原始数据，即不能保证数据在传输过
程中没有被修改，也就是数据完整性得不到保证。我们需要采取一定的技术
手段，使接收方在接收到数据时可以对数据完整性进行验证，以保证数据在
通信过程中没有被非法或者未知原因修改。  
防抵赖。在日常生活中，我们在签合同的时候都会写上自己的名字以表达对
合同内同的认同，一旦签订了合同，合同双方都对合同所规定的内容负有一
定的责任，不得抵赖。在计算机系统和智能卡中，我们同样需要一种技术手
段来保证通信双方在通信过程中对自己发送的信息负责，具体可以通过数字
签名技术来保证。


数据的私有安全性设计

数据的私有性如果不采用特别的保护措施，那么在订购过程和支付过程中的
定单信息甚至包括密码等在 Intemmet中开放传输的数据都可能被第三者监视和阅
读。考虑到巨大的传输量和难以计数的传输途径，想任意窃听一组数据传输是不
可能的，但是一些设置在Web服务器的黑客程序却可以查找和收集特定类型的
数据。这些数据包括信用卡、存款的账号和相应的口令。同时因为Internet的开
放性设计，数据私有性和安全性还包括数据传输之外的问题，例如连入Intermet
的数据存储网络驱动器的安全性，所以任何存储在 Web 服务器上的数据必须采
取保护措施。

其保护措施是采用在客户向商家订购或支付过程中，客户填写定单，包括项
目列表、价格、总价、运费、搬运费和税费，定单可通过电子化方式从商家传过
来，或由客户的电子购物软件建立。其次商家根据定单形成账单，然后商家将账
单和确认单发送到客户的金融机构请求支付认可。其中，客户和商家之间需进行
双向身份认证，定单、账单、确认单进行数字签名，同时利用双重签名技术保证
商家看不到客户的账号信息，即被发送文件用Hash编码加密产生128bit的数字
摘要。发送方用自己的私用密钥对摘要再加密，这就形成了数字签名。将原文和
加密的摘要同时传给对方，对方用发送方的公共密钥对摘要解密，同时对收到的
文件用Hash编码加密产生又一摘要。将解密后的摘要和收到的文件在接收方重
新加密产生的摘要相互对比。如两者一致，则说明传送过程中信息没有被破坏或
篡改过，否则不然。

3.5.2 数据的完整性安全设计

由于Intemet的开放体系，如果某些黑客或有意破坏者具备了特定的知识和
工具完全可以更改传输中的数据，从而破坏数据的完整性。因此，要采取适当的
存取访问控制，以保证数据存取系统的安个。在电子商务中务必保存数据最初的
格式和内容。它的保护措施是采用在客户问商家订购或支付过程中，商家从客户
的金融机构请求支付，其安全需求包括商家与银行之间的双向身份认证。保证除
商家外的任何第三方均不能了解账单的内容,除商业银行外的任何第三方均不能
了解支付信息的内容,同时对支付信息进行数字签名以及支付信息应包括解决争
议的足够信息。商业银行还需要对确认单进行数字签名，提供防篡改和不可否认
保护。确认信息中包括发票号、交易号、转账金额和转账结果等。

3.5.3 身份认证安全设计

在电子商务的具体实现中，首先要确认当前的通讯、交易和存取要求是合法
的。例如Intermet中的计算机系统的身份是其由地址确认的。黑客通过欺
骗，使用虚假的卫地址，从而达到隐瞒自己身份盗用他人身份的目的。在日常
电子邮件的使用中可以很容易地发匿名邮件，或者使用不真实的邮件用户名。因
此，在电子商务系统中必须建立严格的身份认证机制以确保参加交易各方的身份
真实有效，其安全措施是采用CCITTX.509国际标准所规定的数字证书。

3.5.4 不可否认安全设计

不可否认主要包含数据的原始记录和发送记录，确认数据已经完成发送和接
收，防止接收用户更改原始记录，或在已经收到数据以后否认收到数据，并拖延
自己的下一步工作。为了保证交易过程的可操作性，必须采取可靠的方法确保交
易过程的真实性，保证参加电子交易的各方承认交易过程的合法性。

3.6系统组成及功能设计

根据参与电子商务的角色和交易流程,可以将整个电子支付系统划分为客户
子系统、商家子系统、支付网关子系统、数字证书授权与认证子系统四部分组成
其系统框架结构图如图3-10所示。

基于对称算法的身份鉴别和密钥协商

为了保证数据的安全性，在进行身份鉴别的过程必须保证安全可靠。所以首先需
要满足的条件是鉴别过程的数据要具有保密性，同时为保证数据发送过程中不被修
改，也要保证数据的完整性  
基于上述分析，在鉴别过程中我们需要使用报文鉴别技术来保证完整性，同时需
要使用密码算法技术来保证数据的安全性。那么在执行鉴别之前，通信双方应该提
前协商好使用的密码算法和密钥。  
首先可以由读卡器产生随机数，然后使用报文鉴别技术和加密技术将数据传输给
智能卡，智能卡通过使用相同的密码算法和密钥在对数据验证后可以判断读卡器是
否合法。  
在验证了读卡器合法后，智能卡需要返回信息给读卡器以证明自身的合法性，同
样使用报文鉴别技术和数据加密技术将读卡器发送来的随机数发送回去，同时产生
自己的随机数，以备后续导出会话密钥使用。  
读卡器接到数据后通过对数据进行分析，得出返回的随机数是自己之前发送的
机数并且可以使用自己的密码算法和密钥进行正确解密。从而判断了智能卡的合法
性，然后返回鉴别成功消息。此时完成了双方相互认证过程。  
相互认证成功完成后，双方使用密码算法和共享密钥对读卡器产生的随机数进行
加密，将加密结果作为子密钥。然后利用密码算法和子密钥对智能卡产生的随机数
进行加密，将加密结果作为会话密钥。  
从上述过程中可以看出鉴别过程安全可靠,会话密钥的产生跟智能卡和读卡器产
生的随机数紧密相关，而且由于随机数的不确定性，更增加了会话密钥的安全。
鉴别协议的实现

基于对称算法的身份鉴别和密钥协商实现

基于对称算法的鉴别协议在执行之前，需要将读卡器和智能卡进行密钥的初始
化，也就是通信双方需要保存相同的密钥以被后续使用。实现具体步骤如下:
谈卡器产生一个随机数A并将该随机数使用MAC算法加入鉴别码，然后通过共享密钥对该随机数进行加密，将加密后的数据发送至智能卡。
智能卡在收到该加密数据后通过共享密钥进行解密，并对原始数据进行MAC运算，将运算结果和发送来的MAC签别码进行比较，如果相同则继续鉴别，
不同则停止鉴别。
智能卡产生随机数B，使用共享密钥对获取的随机数A进行加密，加密结果作为子密钥。使用该子密钥对随机数A和B进行MAC码计算，使用共享密钥对A、B和MAC码加密并将加密结果发送给读卡器。
读卡器接收到数据后通过共享密钥对接收数据进行解密。解密后将解密出的数据A和之前产生的随机数A进行对比如果相同则继续，不同则停止鉴别。
使用加密算法对随机数A进行加密导出子密钥,然后对随机数A、B进行MAC码计算，将计算结果和发来的MAC码进行对比，如果相同则继续否则立即终止鉴别过程。
读卡器使用子密钥对随机数B进行加密，加密得到的结果作为后续的会话密钥。返回消息告诉智能卡鉴别成功。
智能卡使用子密钥对随机数B加密，作为后续会话密钥。

基于非对称算法的身份监别和密钥协商

非对称算法的身份鉴别可以使用数字证书来完成，数字证书一般有第三方证书认
证机构进行颁发，包含公钥和相关信息。使用数字证书和公钥算法，利用数字签名
技术保证数据的安全  
在鉴别之前，在智能卡和读卡器初始化的时候，需要第三方机构给智能卡和读卡
器颁发相应证书并写入终端设备，为后续鉴别过程使用做准备。当准备工作做好了
之后可以开始进行身份鉴别了  
首先由读卡器产生随机数，然后对随机数进行数字签名，将签名数据和读卡器证
书一同发送给智能卡。  
智能卡接到数据后首先验证证书，成功验证后从证书中获取公钥对签名数据进行
验签。验签成功则说明读卡器合法。然后产生一个随机数，并将该随机数和验签获
取的随机数一起使用智能卡私钥签名，签名的结果连同智能卡证书发送给读卡器。
读卡器收到数据后同样进行证书验证，并获取公钥。然后利用公钥对接收数据进
行验签。验签成功后比对验签获取的数据和之前发送的随机数是否相同，如果相同
说明智能卡合法。  
通过上述鉴别过程，通信双方借助数字证书和数字签名技术完成了相互认证。然
后我们可以使用智能卡产生的随机数作为后续通信过程的会话密钥。  

3.2 基于非对称算法的身份鉴别和密钥协商实现

非对称算法的身份鉴别和密钥协商过程较为复杂，需要使用到证书。证书中包含
公钥和相关信息，一般有第三方证书认证机构进行颁发。具体鉴别步骤如下:  
读卡器产生随机数 A，然后使用读卡器的私钥对随机数A进行数字签名，并
将签名结果和读卡器证书一同发送给智能卡。  智能卡在接收到读卡器发送来的鉴别请求后，首先对读卡器的证书进行合法性验证，如果证书无效则立即终止鉴别过程，如果证书有效则继续。  智能卡从读卡器发来的证书中获取读卡器的公钥，并使用该公钥对接收到的
数据进行验签，验签成功则说明读卡器合法，验签失败则鉴别终止。  智能卡产生随机数B，并对随机数A和B进行签名，并使用读卡器的公钥对签名结果进行加密。然后将签名的结果连同智能卡的证书一起发送给读卡器读卡器在接收到智能卡发送来的响应消息后，首先对智能卡的证书进行合法性验证，如果证书无效则立即终止鉴别过程，如果证书有效则继续。  
读卡器从智能卡发来的证书中获取智能卡的公钥，并使用该公钥对接Zl的数据进行验签，验签成功则说明智能卡合法，验签失败则鉴别终止。  A将验签得到的数据A和之前发送的随机数A进行比对，如果相则说合法。读卡器使用自己的私钥通过解密获取随机数B作为后续回话密钥。

![Alt text](image-3.png)
2, 密码体制及算法
对称密码体制在电子支付系统中用于敏感数据加解密，公钥密码体制常用于电子支付系统中的身份认证。
在电子支付系统中，目前广泛采用PKI/CA公钥密码体制：通过第三方的可信任机构CA签发的公钥证书，把用户的公钥和用户的其他标识信息(如名称、身份证号等)捆绑在一起，从而可以在网络上验证用户公钥的有效性。
有研究者提出基于身份的密码学体制IBC(Identity-Based Cryptography)，并在此体制下设计了大量签名、密钥协商、加解密算法。IBC体制目前已逐渐走向实际应用
对称算法方面，在国内，随着三金工程尤其是金卡工程的启动，DES算法在POS、ATM、磁卡及智能卡(IC卡)、加油站、高速公路收费站等领域被广泛应用，以此来实现关键数据的保密，如信用卡持卡人的PIN的加密传输，IC卡与POS间的双向认证、金融交易数据包的MAC校验等，均用到DES算法。但随着攻击及计算能力的增强，DES安全强度已不能满足系统保密性需求，因此算法开始向AES迁移，在此期间，使用3DES作为DES向AES过渡的加密算法。AES算法有安全、非保密、公开、灵活、简单且易于实现等特点，能在各种软件和硬件平台满足计算效率，包括智能卡，是目前较理想的对称密码算法。
非对称密码算法方面，与金融领域相关度较高的通常是数字签名和Hash算法。数字签名通常基于RSA、ECC算法构造，以实现身份认证和信息的抗抵赖性安全需求;Hash函数可选SHA-2、SHA-3等算法。
3, 安全协议
电子支付的安全性需要依靠安全协议的保障，密码体制及算法需要内置于安全协议中才能实现其安全作用。为了保障交易安全，人们开发了各种电子支付安全协议。目前，应用最为广泛的电子支付安全协议主要有SSL/TLS协议、SET协议和3-D Secure三种。其中，3DS协议是国际卡组织最为推荐使用的协议之一

4, 电子支付密码技术发展与研究方向  
新的公钥密码体制。经调研，有两种新的密码体制可以作为保障电子支付系统安全的密码体系：基于身份的公钥密码体制IBC和无证书公钥密码体制CL-PKC。
新的签名技术。作为电子支付领域中关键技术之一的电子货币，将对未来电子支付领域的发展起到至关重要的作用，若银行能够建立有效安全的电子货币系统，才能够在真正意义上实现互联网信息化时代的电子支付。安全性一直是电子货币系统在设计过程中最受关注的问题，因此对群签名、盲签名等特殊签名技术的研究持续升温，用以实现电子货币系统的匿名性、不可跟踪性等特殊性质。  
新的密码技术。除了对传统密码体制及算法的研究之外，近几年出现的量子密码、DNA密码等新兴密码技术也应引起关注，因为一旦这些新兴密码技术得到了实际应用，将会对现有系统中的密码技术产生颠覆式的影响。

4.1 密码体制 IBC
基于身份标识的密码系统（Identity-Based Cryptograph, 简称IBC），是一种非对称的公钥密码体系标识密码的概念由Shamir于1984年提出，其最主要观点是系统中不需要证书，使用用户的标识如姓名、
IP地址、电子邮箱地址、手机号码等作为公钥。用户的私钥由密钥生成中心(Key Generate Center,简称KGC)根据系统主密钥和用户标识计算得出。用户的公钥由用户标识唯一确定，从而用户不需要第三方来保证公钥的真实性。

4.2 密码体制CL-PKC
CL-PKC(Certificateless public key cryptography)指无证书公钥密码体制，是基于传统PKI与IBC的基础上发展而来。在CL-PKC体制下，每个实体的私钥由两部分组成，一部分由实体自己生成，另一部分由第三方可信实体生成，实体的公钥由私钥经过一定的计算得到。
CL-PKC既克服了传统PKI证书管理问题，又客服了IBC中密钥托管问题，结合了两者优点。可以看出，基于CL-PKC的安全技术更适用于终端数量剧增、通信节点趋于移动化的当前网络状况，对于电子支付领域来说，这种密码体制更适用于当前电子支付移动化的应用场景，具有很大的应用潜力。密钥生成中心KGC(Key Generation Center)。KGC生成并秘密保存整个公钥密码系统的主私钥, KGC根据网络中合法用户的身份信息(如Email地址或者身份证号码)和系统主私钥计算出用户的部分私钥，并通过一个机密的、安全的通道传送给用户。用户收到KGC为其生成的部分私钥后，可以利用系统主公钥来验证其合法性及正确性;同时，用户再选择一个随机数作为自己的秘密值，秘密值与部分私钥共同组成用户完整的私钥。用户的公钥由私钥通过一定的计算得出，并在必要的时候公布出去无证书公钥密码体制可以有效克服基于身份的密码体制中密钥托管问题的原因是：系统中的可信第三方KGC只能为网络中的用户生成一部分私钥，用户的另一部分私钥由自己选择并生成，因此KGC无法得知任何用户的全部私钥，从而克服了密钥托管的问题。

4.3 群签名
以电子货币的发行为例：如果使用普通的数字签名，那么只能由一个可信的银行发行电子货币，否则银行各自发行自己的电子货币将导致货币无法得到统一认证，进而引起货币发行混乱。因此，可以看出，使用群签名技术可以构建由多个银行发行电子货币的系统模型，这些银行形成一个群体受中央银行的控制，中央银行担当了群管理人的角色。

4.4 盲签名
盲签名是一种特殊的数字签名，其特殊性体现在签名者并不知道签署的内容，即便签名者知道了签名与消息对，也无法将它们联系起来。因此，盲签名技术也可以应用到电子货币系统中。
以电子货币使用的流程为例：用户从银行获得电子货币，然后在商家处使用给予电子货币的凭证，最后商家再到银行将凭证换成现实世界的现金或存款。这里要求电子货币是完全匿名的，银行不能将签署的电子货币与用户联系起来，同时用户的使用情况也不能被跟踪，即不能通过电子货币的使用凭证将用户追踪到。

4.5 代理签名
现实中，当客户(原始签名人)因为某些原因不方便在网上进行电子支付活动时，需要代理人(代理签名人)为其在网上寻找和购买一些特殊的商品或服务，可以使用基于代理签名的安全电子支付。代理签名在银行系统、电子货币等领域，都具有无法比拟的发展前景。

### 远程支付（支付宝）

支付流程：
1. 用户向服务器请求一个付款
2. 服务器生成一个带签名的订单发送给客户端
3. 客户端通过这个订单向 app sdk 请求付款
4. sdk 把用户引入支付宝付款界面进行支付
5. 支付成功后支付宝向前端返回支付成功结果，并且向服务器发送一个支付通知
6. 服务器接收通知并且验证是否是支付宝发送的成功结果
app 客户端需要做的很简单：
1. 向自己的服务器请求一个订单，
2. 接收到订单后，向支付宝 sdk 发情一个支付请求
3. 交易结束后返回一个成功或者失败

![Alt text](image-4.png)

网上支付存在哪些安全隐患：
• 支付密码泄漏。（主要原因）
一旦攻击者通过某种方式得到支付密码，可以轻易地冒充持卡人通过互联网进行消费，给持卡人带来损失。这是人们对网上支付安全的主要担心所在。
• 支付数据被篡改。
在缺乏必要的安全防范措施情况下，攻击者可以通过修改互联网传输中的支付数据。譬如，攻击者可以修改付款银行卡号、修改支付金额、修改收款人账号等，达到谋利目的并制造互联网支付事件。
• 否认支付。
网上支付是一个通过商业银行提供的网上结算服务将资金从付款人账户划拨到收款人账户的过程。对于资金划出操作，若付款人否认发出资金划出指令，商业银行将处于被动局面；对于资金划入操作，若商业银行否认资金划入操作，收款人将处于不利境地。

### 简述已知明文攻击和选择明文攻击的区别，并说明在公钥密码中，为何选择明文攻击是最基本的攻击类型。

在公钥密码中，选择明文攻击被认为是最基本的攻击类型，原因在于公钥密码体制的特性。公钥密码体制中，加密密钥是公开的，任何人都可以使用它来加密消息。因此，攻击者可以轻易地获取加密密钥，并选择任意的明文进行加密，以观察加密结果。这种攻击方式允许攻击者通过主动选择明文来测试和分析加密算法的弱点，从而可能发现加密算法的漏洞或推断出私钥信息。由于攻击者可以控制加密过程，选择明文攻击提供了更多的信息和更大的灵活性，使其成为评估公钥密码体制安全性的一个重要标准。

### 公钥密码体制相对于传统密码体制的优势

密钥分发：在传统密码体制（对称密码体制）中，加密和解密使用相同的密钥，因此密钥的分发和管理是一个复杂的问题。公钥密码体制通过使用公钥和私钥解决了这个问题，公钥可以公开分发，而私钥则保密。

安全性：由于加密和解密使用不同的密钥，即使公钥被截获，没有私钥也无法解密信息，这提高了系统的安全性。

数字签名：公钥密码体制支持数字签名，发送方可以用自己的私钥对信息进行签名，接收方可以用发送方的公钥验证签名。这确保了信息的完整性和发送方的身份认证。

抗抵赖性：数字签名还提供了抗抵赖性，发送方无法否认他们发送的信息，因为他们无法否认使用了自己的私钥进行签名。

密钥管理：在大规模系统中，公钥密码体制简化了密钥管理，因为不需要为每对通信者生成和分发一个共享的秘密密钥。

灵活性：公钥密码体制允许更多的灵活性，例如，一个用户可以有一个公钥供任何人加密信息，而保留私钥以解密所有接收到的信息。

尽管公钥密码体制有许多优势，但由于其计算复杂性，它们通常比对称密码体制慢，因此在实际应用中，常常会结合使用两者，例如在安全传输密钥时使用公钥密码体制，在实际数据传输中使用对称密码体制。

### 可证明安全性

可证明安全性是指这样一种「归约」方法：

首先确定密码体制的安全目标，例如，加密体制的安全目标是信息的机密性，签名体制的安全目标是签名的不可伪造性。然后根据敌手的能力构建一个形式化的安全模型；最后指出如果敌手能成功攻破密码体制，则存在一种算法在多项式时间内解决一个公认困难的数学问题或公认安全的密码体质。总之，可证明安全性就是利用反证法的思想把密码算法/协议规约到一个数学难题或密码体质，通过后者的困难性或安全性来证明前者的安全。

对于数字签名体制，存在以下3种伪造类型：

完全攻破：敌手能够产生与私钥持有者相同的签名，这相当于恢复出了私钥

选择性伪造：敌手能够伪造一个他选择的消息的签名

存在性伪造：敌手能够伪造一个消息的签名，这个消息可能仅仅是一个随机比特串

对于数字签名体制，存在以下2种伪造类型：

被动攻击：在被动攻击中，敌手被告知一个公钥，要求产生一个选择性伪造或存在性伪造。这是一种比较弱的攻击模型。

主动攻击：积极攻击中最强的攻击是适应性选择消息攻击(Adaptive Chosen Messages Attack)，即敌手可以访问一个签名预言机，它能够产生合法的签名。敌手的目标是产生一个消息的签名，当然这个消息不能是已经询问过签名预言机的消息。

对于一个安全参数为k的密码体制，如果敌手成功的概率大于1/p(k)，我们就说这个敌手以一个不可忽略的概率成功，这里的p是一个以k为变量的多项式。

可证明安全性的目的在于证明：如果一个敌手能够攻破一个密码体制的某个安全概念，那么我们就可以利用该敌手做一些认为不可能的事情。我们假设敌手A是一个主动攻击敌手，即对于Schnorr签名算法，他能进行签名询问。

我们现在希望能够构造一个新算法BA，它能够在输入一个离散对数问题实例和调用多项式次敌手A的情况下，以一个不可忽略的概率求解离散对数问题。算法BA说明了如果存在敌手A，就存在一个多项式时间离散对数问题求解算法，能够以一个不可忽略的概率解决离散对数问题。既然我们目前并不相信存在这样的离散对数问题求解算法，我们也可以断定这样的敌手A是不存在的

        假设存在一个攻击者A能够伪造一个有效的Schnorr签名，即A能够找到一个(e',s')，使得对于某个消息m'，有H(m'||g(-1))v(-1)是e'在模q下的乘法逆元），但A不知道签名者的私钥s。由于A不知道s，因此A必须找到一个s'的值，使得上述等式成立。这等价于找到一个整数x，使得g(s'e'e'），这是一个离散对数问题。如果离散对数问题是安全的，那么A找到这样的x（即伪造一个有效的签名）在计算上是不可行的。因此，如果离散对数问题是安全的，那么Schnorr数字签名方案就是EU-CMA安全的。

### 远程支付系统

应用问题描述

远程支付系统，特别是移动支付服务业务系统，允许用户通过移动设备（如智能手机）访问支付平台，发起支付交易请求。这种系统为用户提供了移动支付、用户资金转移等服务。在这种支付场景中，用户与支付平台之间的交互安全是至关重要的，需要确保交易的安全性和数据的保密性。

主要安全问题

身份认证问题：在移动支付交易中，涉及个人、商户、第三方支付、银行等多个参与方，必须有效解决交易各方的身份认证问题，包括用户的身份认证和设备的身份认证。

数据的机密性、完整性和不可否认性：商家和用户在公用网络上传送的敏感信息易被他人窃取、滥用和非法篡改，造成损失，所以必须实现信息传输的机密性和完整性，并确保交易的不可否认性。

隐私信息泄露：支付账号和密码等隐私信息在网络上传送过程中可能被窃取或盗用。

支付金额被更改：支付过程中支付金额可能被非法更改。

可以采用的安全协议或密码学技术

TLS/SSL协议：通过TLS/SSL协议完成用户和远程服务器间的网络安全连接，通过数字证书实现双端身份认证，并使用协商的对称会话密钥对后续传输的交易信息进行加密和完整性保护。

数字签名技术：如金融IC卡的复合动态数据认证，使用卡片私钥完成对重要交易数据的签名认证，确保交易的不可否认性。

支付标记化(Payment Tokenization)技术：通过支付标记(Token)代替银行卡卡号进行交易，同时确保该Token的应用被限定在特定的商户、渠道或设备，从而避免卡号信息泄露所带来的风险。

多因素身份认证：利用生物特征识别（如指纹识别）引入持卡人身份认证过程，并基于可信执行环境技术，提供了生物特征信息手机端的安全存储和比对，以确保用户隐私。

对称加密算法（如AES）：使用AES算法对数据进行加密，确保数据在传输过程中的机密性，推荐使用256比特或以上的密钥长度。

非对称加密算法（如RSA、ECC）：使用非对称加密算法进行密钥交换和数字签名，推荐RSA密钥长度为2048比特或以上，ECC推荐密钥长度为256比特或以上。

数字信封技术：结合对称加密和非对称加密技术，通过公开密钥加密含有私有密钥的数字信封，并使用私有密钥加密原本的密文，提升信息的安全性。

数字摘要技术：通过使用一定算法对传送的数据生成一个特定值，并将此值一起传送给接收者，接收者在收到后可以通过新值与特定值的对比来检验数据在传送过程中是否被改动。

### 请针对电子支付中至少两类支付方式的安全性进行比较和分析

不同支付方式在实际应用中潜在的风险和规避方法。

        攻击模型和风险评估：3 分
        在电子支付系统中，攻击模型主要包括以下几种：
        中间人攻击（Man-in-the-Middle, MitM）：攻击者截获并篡改支付过程中的数据。
        重放攻击：攻击者截获支付请求并重复发送，以期达到欺诈目的。
        拒绝服务攻击（Denial-of-Service, DoS）：攻击者通过大量请求使支付系统无法处理正常业务。
        身份盗用：攻击者通过各种手段获取用户的身份信息，冒充用户进行支付。
        两类支付方式的支付流程说明与分析：5 分
        1. 移动支付（如支付宝、微信支付）
        流程：
        用户选择商品并发起支付请求。
        支付平台生成支付订单，并请求用户确认支付。
        用户输入支付密码或使用生物识别验证身份。
        支付平台通过加密通道将支付请求发送给银行或支付网关。
        银行处理支付请求，并返回支付结果。
        分析：移动支付依赖于互联网连接，因此对网络安全性要求较高。支付过程中的数据加密和身份验证是关键。
        2. 银行卡支付（如信用卡、借记卡支付）
        流程：
        用户在POS机或网上商城选择商品并输入卡信息。
        商家将支付请求发送至支付处理网络。
        支付处理网络向发卡行请求授权。
        发卡行验证卡信息并返回授权结果。
        商家根据授权结果完成交易。
        分析：银行卡支付涉及多个参与方，包括用户、商家、支付处理网络和银行。支付过程中的每一步都需要确保数据的安全性和完整性。
        数据保密性与身份认证方法：5 分
        3. 数据保密性
        移动支付：使用SSL/TLS协议对传输的数据进行加密，保证数据在传输过程中的机密性和完整性。
        银行卡支付：对敏感数据如信用卡信息、用户身份证信息、密码等进行加密后存储到数据库中，以防止数据泄露。
        4. 身份认证方法
        移动支付：采用多因素身份认证，包括密码、短信验证码、生物识别等。
        银行卡支付：使用芯片卡技术，结合个人识别码（PIN）进行身份验证。
        两种支付方式的比较较全面合理：5 分
        比较：
        便捷性：移动支付通常更便捷，用户可以通过手机随时随地完成支付。
        安全性：两种支付方式都采用了高级加密标准（AES）和公钥基础设施（PKI）等技术来保护数据传输的安全。
        适用范围：移动支付适用于线上和线下小额支付，而银行卡支付适用于更广泛的支付场景，包括大额支付。
        成本：移动支付通常对小额交易成本较低，而银行卡支付可能涉及更高的交易费用，尤其是跨境交易。
        用户信任度：银行卡支付由于历史悠久，用户信任度相对较高；移动支付虽然发展迅速，但在某些地区和人群中信任度仍在建立中。
        通过上述分析，我们可以看到，移动支付和银行卡支付各有优势和特点，用户在选择支付方式时应根据自身需求和对安全性的考量做出决策。

### Padding在对称加密中的应用

在对称加密中，明文通常是由固定长度的块组成，这就需要对明文进行填充。

1.Hash 函数
现代的Hash函数通常处理由固定长度的块组成，最早的hash函数通常包括几种填充模式。通常用来防止Hash函数被长度扩展攻击（length extension attacks）。
许多填充模式通过添加可预测的数据到最后一个块中完成填充。

2.分组密码的操作模式
cipher-clock chaining (CBC)模式是分组密码操作模式的样例。在对称加算法的分组加密模式中，要求明文必须是加密块的整数倍，这就要求必须对明文进行填充。

### RSA签名的过程如下：

A生成一对密钥（公钥和私钥），私钥不公开，A自己保留。公钥为公开，任何人可以获取。
A用自己的私钥对消息加签，形成签名，并将加签的消息和消息本身一起传递给B。（A先对消息用hash算法做一次处理，得到一个字符串哈希值，再用A的私钥对哈希值做一次加密得到一个签名，然后把签名和消息（原文）一起发送给B。）
B收到消息后，在获取A的公钥进行验签，如果验签出来的内容与消息本身一致，证明消息是A回复的（B用A的公钥对签名做解密处理，得到了哈希值a，然后用同样的hash算法对消息许做一次哈希处理，得到另一个哈希值b，对比a和b，如果两个值是相同的，那么可以确认消息是A发出来的）。
在这个过程，只有2次传递过程，第一次是A传递加签的消息和消息本身给B，第二次是B获取A的公钥，即使都被地方截获，也没有危险性，因为只有A的私钥才能对消息进行签名，即使知道了消息内容，也无法伪造带签名的回复给B，防止了消息内容的篡改。